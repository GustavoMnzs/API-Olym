generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Food {
  id           Int      @id @default(autoincrement())
  description  String   @db.VarChar(255)
  groupName    String   @map("group_name") @db.VarChar(100)
  sourceTable  String   @map("source_table") @db.VarChar(20)
  portionGrams Decimal  @map("portion_grams") @db.Decimal(10, 2)
  deletedAt    DateTime? @map("deleted_at")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  nutrients FoodNutrient[]
  measures  Measure[]

  @@index([description])
  @@index([groupName])
  @@index([sourceTable])
  @@map("foods")
}

model Nutrient {
  id    Int    @id @default(autoincrement())
  name  String @unique @db.VarChar(100)
  unit  String @db.VarChar(20)

  foods FoodNutrient[]

  @@map("nutrients")
}

model FoodNutrient {
  id           Int     @id @default(autoincrement())
  foodId       Int     @map("food_id")
  nutrientId   Int     @map("nutrient_id")
  valuePer100g Decimal @map("value_per_100g") @db.Decimal(10, 4)

  food     Food     @relation(fields: [foodId], references: [id], onDelete: Cascade)
  nutrient Nutrient @relation(fields: [nutrientId], references: [id], onDelete: Cascade)

  @@unique([foodId, nutrientId])
  @@map("food_nutrients")
}

model Measure {
  id                 Int     @id @default(autoincrement())
  foodId             Int     @map("food_id")
  measureDescription String  @map("measure_description") @db.VarChar(100)
  grams              Decimal @db.Decimal(10, 2)

  food Food @relation(fields: [foodId], references: [id], onDelete: Cascade)

  @@map("measures")
}
