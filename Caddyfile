# Substitua SEU_DOMINIO.com.br pelo seu domínio real
# O Caddy vai gerar certificado SSL automaticamente

SEU_DOMINIO.com.br {
    # Reverse proxy para a API
    reverse_proxy api:3000 {
        # Health check
        health_uri /health/live
        health_interval 30s
        health_timeout 10s
    }

    # Headers de segurança
    header {
        # Remover header que expõe tecnologia
        -Server
        
        # Segurança
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        
        # Remover headers sensíveis da resposta
        -X-Powered-By
    }

    # Logs
    log {
        output file /var/log/caddy/access.log {
            roll_size 10mb
            roll_keep 5
        }
    }

    # Compressão
    encode gzip zstd
}

# Redirecionar www para non-www (opcional)
www.SEU_DOMINIO.com.br {
    redir https://SEU_DOMINIO.com.br{uri} permanent
}
